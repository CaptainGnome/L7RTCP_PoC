### **L7RTCP PoC (Python)**

Это Proof-of-Concept реализация **Layer-7 Resilient Transmission Control Protocol (L7RTCP)** на языке Python с использованием фреймворка FastAPI. Этот проект демонстрирует основные концепции протокола, такие как инициация передачи, согласование возможностей, передача данных по частям (чанкам), управление потоками и самовосстановление после сбоев.

**Важно:** Этот код является **демонстрационным PoC** и предназначен для изучения спецификации L7RTCP. Он не предназначен для использования в production без значительной доработки.

#### **Особенности Реализации (PoC)**

*   **Язык:** Python 3.8+
*   **Фреймворк:** FastAPI (ASGI)
*   **Сервер:** Uvicorn
*   **Транспорт:** HTTP/1.1 (модель Pull)
*   **Хранение Состояния:** In-Memory (для простоты тестирования)
*   **Генерация ID:** Упрощенная реализация UUIDv7 для `X-Transmission-ID`.

#### **Поддерживаемые Эндпоинты L7RTCP**

1.  **`POST /l7rtcp/init`**
    *   **Назначение:** Инициация новой сессии передачи данных или возобновление существующей.
    *   **Обязательные заголовки:** `X-Client-ID`, `X-Features-Supported`, `X-Session-Type`.
    *   **Опциональные заголовки:** `X-Transmission-ID` (для возобновления), `X-Streams`, `X-TTL`, `X-Max-Packet-Size`, `X-Chunk-Size`.
    *   **Ответ:** `200 OK` с заголовками `X-Transmission-ID`, `X-Features-Enabled` и другими параметрами сессии.

2.  **`POST /l7rtcp/transmit`**
    *   **Назначение:** Передача данных (в режиме Pull) или управление потоками.
    *   **Для передачи данных:**
        *   **Обязательные заголовки:** `X-Transmission-ID`, `X-Stream-ID`, `X-Packet-ID`.
        *   **Ответ:** `209 Pending Transmission` (или `200 OK` для последнего чанка) с данными чанка в теле ответа и заголовком `X-Backpressure-Advice`.
    *   **Для управления потоками:**
        *   **Обязательные заголовки:** `X-Transmission-ID`, `X-Stream-Control`.
        *   **Ответ:** `200 OK` с подтверждением выполнения команды.

3.  **`GET /l7rtcp/status/{transmission_id}`**
    *   **Назначение:** Получение информации о состоянии сессии передачи.
    *   **Ответ:** JSON с информацией о полученных/пропущенных чанках, TTL, статусе активности и т.д.

4.  **`POST /l7rtcp/resend/{transmission_id}`**
    *   **Назначение:** Запрос повторной отправки пропущенных чанков.
    *   **Тело запроса:** JSON с указанием потока и списка номеров чанков.
    *   **Ответ:** Подтверждение получения запроса на повторную отправку.

#### **Быстрый Старт**

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <URL_вашего_репозитория>
    cd <имя_папки_проекта>
    ```

2.  **Создайте виртуальное окружение:**
    ```bash
    python -m venv venv
    # Активируйте venv (см. инструкции для вашей ОС)
    # Linux/macOS: source venv/bin/activate
    # Windows: venv\Scripts\activate
    ```

3.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Запустите сервер:**
    ```bash
    uvicorn app.main:app --reload
    ```
    Сервер будет доступен по адресу `http://127.0.0.1:8000`. Интерактивная документация: `http://127.0.0.1:8000/docs`.

5.  **Протестируйте с помощью `curl` или Postman:**
    *   **Инициация:**
        ```bash
        curl -i -X POST "http://127.0.0.1:8000/l7rtcp/init" \
        -H "X-Client-ID: cli-123" \
        -H "X-Features-Supported: core,resend,ttl,multistream,pull" \
        -H "X-Session-Type: stateful" \
        -H "X-Streams: video;res=480,audio;lang=en" \
        -H "X-TTL: 3600" \
        -H "X-Chuck-Size: 4096"
        ```
    *   **Получение чанка:**
        ```bash
        curl -X POST "http://127.0.0.1:8000/l7rtcp/transmit" \
        -H "X-Transmission-ID: tx-ваш_id_из_init" \
        -H "X-Stream-ID: video;res=480" \
        -H "X-Packet-ID: 0" \
        --output chunk_0.bin
        ```
    *   **Статус:**
        ```bash
        curl -X GET "http://127.0.0.1:8000/l7rtcp/status/tx-ваш_id_из_init"
        ```

#### **Структура Проекта**

```
.
├── app/                  # Основной код приложения
│   ├── __init__.py
│   ├── main.py           # Точка входа FastAPI
│   ├── models.py         # Модели данных (Pydantic, внутренние структуры)
│   ├── handlers.py       # Обработчики HTTP-запросов
│   ├── storage.py        # In-Memory хранилище состояний передач
│   └── utils.py          # Вспомогательные функции (например, генерация UUIDv7)
├── requirements.txt      # Зависимости Python
└── README.md             # Этот файл
```

#### **Дальнейшие Шаги и Возможности**

*   **Реальные данные:** Заменить фиктивные данные на чтение из файлов, баз данных или других источников.
*   **Push-модель:** Реализовать передачу данных по инициативе сервера (например, с использованием WebSocket или WebTransport).
*   **Полная реализация фич:** Добавить поддержку `pause/resume`, `backpressure`, `stateless`, `FEC`, `metrics`.
*   **Постоянное хранение состояния:** Интеграция с Redis, PostgreSQL и т.д.
*   **Безопасность:** Добавить аутентификацию, авторизацию, защиту от replay-атак.
*   **Тестирование:** Написать unit и интеграционные тесты.